{% extends "../../base/template/base.html" %}
{% block title %}{{ topic['title'] }}{% end %}
{% block body %}
<div class="am-g am-g-fixed">
    <div class="am-u-lg-10 am-u-md-10 am-u-sm-centered">
        <div>
            <table class="am-table am-text-sm am-scrollable-horizontal">
                <tr class="row">
                    <td width="60">
                        <img class="am-img-thumbnail am-circle" src="{{ static_url("img/avstar/avstar3.png")}}" width="50" height="50"/>
                    </td>
                    <td>
                        <span class="item-title">
                            <a href="/user/{{ topic['author'] }}" >
                                {{ topic['author'] }}
                            </a>
                        </span>
                        <br>
                        <span>
                            发布于 2016/11/3 &nbsp;
                            <a href="##">举报</a> &nbsp;
                            {% if ismine %}
                                <a href="/topics/update/{{ topic['_id'] }}">编辑</a>
                            {% end %}
                        </span>
                    </td>
                </tr>
            </table>
        </div>
        <article class="am-article">
            <div class="am-article-hd">
                <h1 class="am-article-title">{{ topic['title'] }}</h1>
            </div>
            <div class="am-article-bd" id="content">
                {{ topic['content'] }}
            </div>
        </article>
        <hr>
        <div>
        觉得我的帖子不错，不妨收藏一下 <button type="button" id="favorite" class="am-btn am-round am-btn-xs am-btn-secondary">收藏</button>
        </div>
        <br>
        <form class="am-form">
            <fieldset>
                <table class="am-table am-text-sm am-scrollable-horizontal">
                    <tr class="row">
                        <td width="60">
                            <img class="am-img-thumbnail am-circle" src="{{ static_url("img/avstar/avstar3.png")}}" width="50" height="50"/>
                        </td>
                        <td>
                            <div class="am-form-group">
                                <textarea style="resize: None" rows="4" id="comment"></textarea>
                            </div>
                            <div class="am-form-group">
                                <button type="button" id="publish" class="am-fr am-btn am-btn-primary">提交</button>
                            </div>
                        </td>
                    </tr>
                </table>
            </fieldset>
        </form>
        {% if len(topic['comment']) == 0 %}
            <center>目前还没有评论</center>
        {% end %}
        <ul class="am-comments-list am-comments-list-flip">
            {% for comment in topic['comment'] %}
            <li class="am-comment">
                <a href="/user/{{ comment['username'] }}">
                    <img class="am-comment-avatar" src="{{ static_url("img/avstar/" + comment['_id'] + ".png")}} alt=""/>
                </a>
                <div class="am-comment-main">
                    <header class="am-comment-hd">
                        <div class="am-comment-meta">
                            <a href="/user/{{ comment['username'] }}" class="am-comment-author">{{ comment['username'] }}</a>
                                评论于 <time datetime="">{{ comment['time'] }}</time>
                        </div>
                    </header>
                    <div class="am-comment-bd">{{ comment['content'] }}</div>
                </div>
            </li>
            {% end %}
        </ul>
    </div>
            <!-- goto top -->
<!--         <div class="am-fr">
        <div data-am-widget="gotop" class="am-gotop am-gotop-default" >
            <a href="#top" title="回到顶部">
                <i class="am-gotop-icon am-icon-chevron-up"></i>
            </a>
        </div>
    </div> -->
    <!-- goto top -->
</div>

 <!-- 分享 -->
<!-- <button
  type="button"
  class="am-btn am-btn-secondary"
  data-am-modal="{target: '#my-actions'}">
  Actions
</button>

<div class="am-modal-actions" id="my-actions">
  <div class="am-modal-actions-group">
    <ul class="am-list">
      <li class="am-modal-actions-header">...</li>
      <li><a href="#"><span class="am-icon-wechat"></span> ...</a></li>
      <li class="am-modal-actions-danger">
        <a href="#"><i class="am-icon-twitter"></i> ...</a>
      </li>
    </ul>
  </div>
  <div class="am-modal-actions-group">
    <button class="am-btn am-btn-secondary am-btn-block" data-am-modal-close>取消</button>
  </div>
</div> -->
 <!-- end 分享 -->

<!-- 图片 -->
<!-- <figure data-am-widget="figure" class="am am-figure am-figure-default "   data-am-figure="{  pureview: 'true' }">
  <img src="http://s.amazeui.org/media/i/demos/pure-1.jpg?imageView2/0/w/640" data-rel="http://s.amazeui.org/media/i/demos/pure-1.jpg" alt="春天的花开秋天的风以及冬天的落阳"/>
      <figcaption class="am-figure-capition-btm">
        春天的花开秋天的风以及冬天的落阳
      </figcaption>
</figure> -->
<!-- end 图片 -->
{% end %}
{% block js %}
<script type="text/javascript">
    function getCookie(name) {
        var r = document.cookie.match("\\b" + name + "=([^;]*)\\b");
        return r ? r[1] : undefined;
    }
    $(function(){
        $("#publish").click(function(){
            content = $('#comment').val();
            $.post("/comments/new",{"tid":"{{topic['_id']}}",
                "content":content,
                "uid":"{{current_user['_id']}}",
                "_xsrf":getCookie("_xsrf")},
                function(response){
                    rtn = eval("(" + response + ")");
                    console.log(rtn);
                    if(rtn['success'] != true) {
                        alert(rtn['msg']);
                    } else {
                        window.location.reload();
                    }
            });
        });
    });
</script>
{% end %}